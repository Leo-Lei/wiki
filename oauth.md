---
layout: post
title: OAuth
date: 2016-10-20 15:40:00
tags:
- Java
categories: Java
---

# OAuth

```text
     +--------+                               +---------------+
     |        |--(A)- Authorization Request ->|   Resource    |
     |        |                               |     Owner     |
     |        |<-(B)-- Authorization Grant ---|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(C)-- Authorization Grant -->| Authorization |
     | Client |                               |     Server    |
     |        |<-(D)----- Access Token -------|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(E)----- Access Token ------>|    Resource   |
     |        |                               |     Server    |
     |        |<-(F)--- Protected Resource ---|               |
     +--------+                               +---------------+
```

四大角色：     
* OAuth客户端:
* 资源拥有方:
* 验证服务器:
* 资源服务器:


# 客户端授权模式
客户端必须要获得用户的授权，才能获得令牌。OAuth 2.0定义了四种授权方式：
* 授权码模式
* 简化模式
* 密码模式
* 客户端模式

### 授权码模式(authorization code)
授权码模式是功能最完整，流程最严密的模式。特点是通过客户端的后台服务器，与“服务提供商”的认证服务器进行交互。      
流程如下：        
* 用户访问客户端，后者将前者导向认证服务器。
* 用户选择是否给予客户端授权。
* 假设用户给予授权，认证服务器将用户导向客户端事先指定的"重定向 URI"（redirection URI），同时附上一个授权码。
* 客户端收到授权码，附上早先的"重定向 URI"，向认证服务器申请令牌。这一步是在客户端的后台的服务器上完成的，对用户不可见。
* 认证服务器核对了授权码和重定向 URI，确认无误后，向客户端发送访问令牌（access token）和更新令牌（refresh token）。

### 简化模式


### 密码模式
密码模式中，用户要向客户端提供自己的用户名和密码。客户端使用这些信息，想服务提供商索要授权。在这种模式中，用户必须把自己的密码给客户端。但是客户端不能保存密码。这通常用在用户对客户端高度信任的情况下，比如客户端是操作系统的一部分，或者由一个著名公司出品。而认证服务器只有在其他授权模式无法执行的情况下，才能考虑使用这种模式。流程如下：        

* 用户向客户端提供用户名和密码。
* 客户端将用户名和密码发给认证服务器，向后者请求令牌。
* 认证服务器确认无误后，向客户端提供访问令牌。

### 客户端模式
流程如下：        
* 客户端向认证服务器进行身份认证，并要求一个访问令牌。
* 认证服务器确认无误后，向客户端提供访问令牌。














