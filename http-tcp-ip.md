---
layout: post
title: Http/TCP/IP Protocol
date: 2016-08-29 15:15:00
tags:
- Java
categories: Java
description: The tutoria will describe the useage of Linux.
---


# IP
`192.168.1.1/24`     就表示ip是192.168.1.1, 子网掩码是255.255.255.0


```text              
          OSI              TCP/IP
  ┌─────────────────┬────────────────────┐
7 │  Application    │ Applications       │
  |─────────────────┤ (FTP, SMTP,        │
6 │  Presentation   │   HTTP, etc)       │
  |─────────────────┤                    │
5 │  Session        │                    │
  |─────────────────┼────────────────────│
4 │  Transport      │ TCP(host-to-host)  │
  |─────────────────┼────────────────────│
3 │  Network        │       IP           │
  |─────────────────┼────────────────────│
2 │  Data link      │                    │
  |─────────────────┤ Network access     │
1 │  Physical       │                    │
  └─────────────────┴────────────────────┘

```


# TCP

```text
TCP package structure
                        1                       2                       3                       4
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
┌───────────────────────────────────────────────┬───────────────────────────────────────────────┐
│                   Source Port                 │                Destination Port               │
|───────────────────────────────────────────────┴───────────────────────────────────────────────│
│                                          Sequence Number                                      │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                         Acknowledgment Number                                 │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│           |           | U | A | P | R | S | F │                                               |                   
│ Offset    |  Reserved | R | C | S | S | Y | I │                  Windows                      |
│           |           | G | K | H | T | N | N │                                               |
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                    Checksum                   │                 Urgent Pointer                │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                             TCP Options (variable length, optional)                           │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                            TCP Data                                           │
└───────────────────────────────────────────────────────────────────────────────────────────────┘
```


**1st handshake:**                  

```text
                        1                       2                       3                       4
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
┌───────────────────────────────────────────────┬───────────────────────────────────────────────┐
│                   Source Port                 │                Destination Port               │
|───────────────────────────────────────────────┴───────────────────────────────────────────────│
│                                      Sequence Number = X                                      │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                         Acknowledgment Number                                 │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│           |           | U | A | P | R |   | F │                                               |                   
│ Offset    |  Reserved | R | C | S | S | 1 | I │                  Windows                      |
│           |           | G | K | H | T |   | N │                                               |
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                    Checksum                   │                 Urgent Pointer                │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                             TCP Options (variable length, optional)                           │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                              TCP Data                                         │
└───────────────────────────────────────────────────────────────────────────────────────────────┘

```

**2nd handshake:**        
```text
                        1                       2                       3                       4
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
┌───────────────────────────────────────────────┬───────────────────────────────────────────────┐
│                   Source Port                 │                Destination Port               │
|───────────────────────────────────────────────┴───────────────────────────────────────────────│
│                                      Sequence Number = Y                                      │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                   Acknowledgment Number = X + 1                               │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│           |           | U |   | P | R |   | F │                                               |                   
│ Offset    |  Reserved | R | 1 | S | S | 1 | I │                  Windows                      |
│           |           | G |   | H | T |   | N │                                               |
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                    Checksum                   │                 Urgent Pointer                │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                             TCP Options (variable length, optional)                           │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                             TCP Data                                          │
└───────────────────────────────────────────────────────────────────────────────────────────────┘

```

**3rd handshake**       

```text
                        1                       2                       3                       4
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
┌───────────────────────────────────────────────┬───────────────────────────────────────────────┐
│                   Source Port                 │                Destination Port               │
|───────────────────────────────────────────────┴───────────────────────────────────────────────│
│                                          Sequence Number                                      │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                 Acknowledgment Number = Y + 1                                 │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│           |           | U |   | P | R | S | F │                                               |                   
│ Offset    |  Reserved | R | 1 | S | S | Y | I │                  Windows                      |
│           |           | G |   | H | T | N | N │                                               |
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                    Checksum                   │                 Urgent Pointer                │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                             TCP Options (variable length, optional)                           │
|───────────────────────────────────────────────────────────────────────────────────────────────│
│                                          TCP Data ( Data: X + 1)                              │
└───────────────────────────────────────────────────────────────────────────────────────────────┘
```



![tcp-3-handshake](https://raw.githubusercontent.com/taizilongxu/taizilongxu.github.io/master/img/ae52f886642e0019fa0973268eeb08b4.jpg)




TCP
查看当前linux机器的tcp连接情况：
```bash
netstat -anlpt
```





